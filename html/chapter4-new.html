<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第四章 智能体经典范式构建 - Hello Agents</title>

    <!-- TailwindCSS 3.0+ -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

    <!-- Alpine.js for reactive components -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        /* Custom styles for Linear-like design */
        .linear-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .sticky-nav {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
        }

        .dark .sticky-nav {
            background: rgba(17, 24, 39, 0.9);
        }

        .paradigm-card {
            background: linear-gradient(145deg, #f3f4f6, #ffffff);
            transition: all 0.4s ease;
        }

        .dark .paradigm-card {
            background: linear-gradient(145deg, #1f2937, #111827);
        }

        .paradigm-card:hover {
            transform: scale(1.02);
        }

        .code-block {
            position: relative;
            margin: 1rem 0;
        }

        .copy-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .code-block:hover .copy-button {
            opacity: 1;
        }

        .timeline-dot {
            position: relative;
        }

        .timeline-dot::before {
            content: '';
            position: absolute;
            left: -2rem;
            top: 50%;
            transform: translateY(-50%);
            width: 1rem;
            height: 1rem;
            background: #667eea;
            border-radius: 50%;
        }

        .timeline-line {
            position: absolute;
            left: -1.75rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, #667eea, #764ba2);
        }

        .mermaid-container {
            text-align: center;
            margin: 2rem 0;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 0.5rem;
        }

        .dark .mermaid-container {
            background: #1f2937;
        }

        .toc-link {
            transition: all 0.3s ease;
            position: relative;
        }

        .toc-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 0;
            background: #667eea;
            transition: height 0.3s ease;
        }

        .toc-link:hover::before,
        .toc-link.active::before {
            height: 100%;
        }

        .feature-icon {
            width: 4rem;
            height: 4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 1rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .comparison-table {
            overflow-x: auto;
        }

        .comparison-table table {
            min-width: 800px;
        }

        .lazy-load {
            opacity: 0;
            transition: opacity 0.6s ease;
        }

        .lazy-load.loaded {
            opacity: 1;
        }
    </style>
</head>
<body x-data="chapterApp()" x-init="init()" class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">

    <!-- Dark Mode Toggle -->
    <button @click="toggleDarkMode()" class="fixed top-4 right-4 z-50 p-3 bg-white dark:bg-gray-800 rounded-full shadow-lg hover:shadow-xl transition-all duration-300">
        <i class="fas fa-moon dark:hidden text-gray-700"></i>
        <i class="fas fa-sun hidden dark:block text-yellow-400"></i>
    </button>

    <!-- Top Navigation -->
    <nav class="sticky-nav sticky top-0 z-40 border-b border-gray-200 dark:border-gray-700 px-6 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <a href="../index.html" class="text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>
                    返回主页
                </a>
                <span class="text-gray-400">|</span>
                <h1 class="text-xl font-bold text-gray-900 dark:text-white">第四章 智能体经典范式构建</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button @click="toggleTOC()" class="text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white">
                    <i class="fas fa-list mr-2"></i>
                    目录
                </button>
            </div>
        </div>
    </nav>

    <!-- Table of Contents Sidebar -->
    <div x-show="showTOC" x-transition class="fixed left-0 top-0 h-full w-80 bg-white dark:bg-gray-800 shadow-2xl z-50 overflow-y-auto">
        <div class="p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-lg font-bold text-gray-900 dark:text-white">目录</h2>
                <button @click="toggleTOC()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav class="space-y-2">
                <template x-for="item in tocItems" :key="item.id">
                    <a :href="'#' + item.id"
                       @click="scrollToSection(item.id)"
                       class="toc-link block py-2 px-4 text-sm text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all"
                       :class="{ 'active bg-gray-100 dark:bg-gray-700': activeSection === item.id }">
                        <span class="font-medium" x-text="item.title"></span>
                    </a>
                </template>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">

        <!-- Chapter Introduction -->
        <section class="mb-12 fade-in">
            <div class="linear-gradient rounded-2xl p-8 text-white">
                <h1 class="text-4xl font-bold mb-4">第四章 智能体经典范式构建</h1>
                <p class="text-lg mb-6 opacity-90">
                    在上一章中，我们深入探讨了作为现代智能体"大脑"的大语言模型。现在，是时候将这些理论知识转化为实践，亲手构建智能体了。
                </p>
                <div class="flex items-center space-x-4">
                    <span class="px-4 py-2 bg-white/20 rounded-full text-sm">
                        <i class="fas fa-clock mr-2"></i>
                        预计阅读时间: 30分钟
                    </span>
                    <span class="px-4 py-2 bg-white/20 rounded-full text-sm">
                        <i class="fas fa-code mr-2"></i>
                        3个实践项目
                    </span>
                </div>
            </div>
        </section>

        <!-- Overview Section -->
        <section id="overview" class="mb-12 fade-in">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                <i class="fas fa-book-open mr-3 text-purple-600"></i>
                章节概览
            </h2>

            <p class="text-gray-700 dark:text-gray-300 mb-8">
                为了更好地组织智能体的"思考"与"行动"过程，业界涌现出了多种经典的架构范式。在本章中，我们将聚焦于其中最具代表性的三种，并一步步从零实现它们：
            </p>

            <!-- Paradigm Cards -->
            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <div class="paradigm-card p-6 rounded-xl shadow-lg card-hover">
                    <div class="feature-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-3">ReAct</h3>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">
                        Reasoning and Acting - 将"思考"和"行动"紧密结合的范式，让智能体边想边做，动态调整。
                    </p>
                    <div class="flex items-center text-purple-600 dark:text-purple-400">
                        <span class="text-sm font-medium">了解详情</span>
                        <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </div>

                <div class="paradigm-card p-6 rounded-xl shadow-lg card-hover">
                    <div class="feature-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-3">Plan-and-Solve</h3>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">
                        "三思而后行"的范式，智能体首先生成一个完整的行动计划，然后严格执行。
                    </p>
                    <div class="flex items-center text-purple-600 dark:text-purple-400">
                        <span class="text-sm font-medium">了解详情</span>
                        <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </div>

                <div class="paradigm-card p-6 rounded-xl shadow-lg card-hover">
                    <div class="feature-icon">
                        <i class="fas fa-sync-alt"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-3">Reflection</h3>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">
                        赋予智能体"反思"能力的范式，通过自我批判和修正来优化结果。
                    </p>
                    <div class="flex items-center text-purple-600 dark:text-purple-400">
                        <span class="text-sm font-medium">了解详情</span>
                        <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- Environment Setup Section -->
        <section id="environment" class="mb-12 fade-in">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                <i class="fas fa-tools mr-3 text-purple-600"></i>
                4.1 环境准备与基础工具定义
            </h2>

            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg mb-6">
                <p class="text-gray-700 dark:text-gray-300 mb-6">
                    在开始构建之前，我们需要先搭建好开发环境并定义一些基础组件。这能帮助我们在后续实现不同范式时，避免重复劳动，更专注于核心逻辑。
                </p>

                <!-- Installation Steps -->
                <div class="space-y-4">
                    <div class="border-l-4 border-purple-600 pl-4 py-2">
                        <h3 class="font-semibold text-gray-900 dark:text-white mb-2">
                            <i class="fas fa-download mr-2"></i>
                            安装依赖库
                        </h3>
                        <p class="text-gray-700 dark:text-gray-300 mb-3">
                            本书的实战部分将主要使用 Python 语言，建议使用 Python 3.10 或更高版本。
                        </p>
                        <div class="code-block">
                            <button @click="copyToClipboard('pip install openai python-dotenv')" class="copy-button px-3 py-1 bg-purple-600 text-white rounded-md text-sm hover:bg-purple-700">
                                <i class="fas fa-copy mr-1"></i>复制
                            </button>
                            <pre><code class="language-bash">pip install openai python-dotenv</code></pre>
                        </div>
                    </div>

                    <div class="border-l-4 border-purple-600 pl-4 py-2">
                        <h3 class="font-semibold text-gray-900 dark:text-white mb-2">
                            <i class="fas fa-key mr-2"></i>
                            配置 API 密钥
                        </h3>
                        <p class="text-gray-700 dark:text-gray-300 mb-3">
                            在你的项目根目录下，创建一个名为 <code class="bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded">.env</code> 的文件。
                        </p>
                        <div class="code-block">
                            <button @click="copyToClipboard('# .env file\nLLM_MODEL_ID=\"YOUR-API-KEY\"\nLLM_API_KEY=\"YOUR-URL\"\nLLM_BASE_URL=\"YOUR-MODEL\"')" class="copy-button px-3 py-1 bg-purple-600 text-white rounded-md text-sm hover:bg-purple-700">
                                <i class="fas fa-copy mr-1"></i>复制
                            </button>
                            <pre><code class="language-bash"># .env file
LLM_MODEL_ID="YOUR-API-KEY"
LLM_API_KEY="YOUR-URL"
LLM_BASE_URL="YOUR-MODEL"</code></pre>
                        </div>
                    </div>

                    <div class="border-l-4 border-purple-600 pl-4 py-2">
                        <h3 class="font-semibold text-gray-900 dark:text-white mb-2">
                            <i class="fas fa-code mr-2"></i>
                            封装基础 LLM 调用函数
                        </h3>
                        <p class="text-gray-700 dark:text-gray-300 mb-3">
                            为了让代码结构更清晰、更易于复用，我们来定义一个专属的LLM客户端类。
                        </p>
                        <div class="code-block">
                            <button @click="copyToClipboard('class HelloAgentsLLM:\n    def __init__(self, model: str = None, apiKey: str = None, baseUrl: str = None, timeout: int = None):\n        self.model = model or os.getenv(\"LLM_MODEL_ID\")\n        apiKey = apiKey or os.getenv(\"LLM_API_KEY\")\n        baseUrl = baseUrl or os.getenv(\"LLM_BASE_URL\")\n        timeout = timeout or int(os.getenv(\"LLM_TIMEOUT\", 60))\n        \n        if not all([self.model, apiKey, baseUrl]):\n            raise ValueError(\"模型ID、API密钥和服务地址必须被提供或在.env文件中定义。\")\n\n        self.client = OpenAI(api_key=apiKey, base_url=baseUrl, timeout=timeout)\n\n    def think(self, messages: List[Dict[str, str]], temperature: float = 0) -> str:\n        response = self.client.chat.completions.create(\n            model=self.model,\n            messages=messages,\n            temperature=temperature,\n            stream=True,\n        )\n        collected_content = []\n        for chunk in response:\n            content = chunk.choices[0].delta.content or \"\"\n            print(content, end=\"\", flush=True)\n            collected_content.append(content)\n        return \"\".join(collected_content)')" class="copy-button px-3 py-1 bg-purple-600 text-white rounded-md text-sm hover:bg-purple-700">
                                <i class="fas fa-copy mr-1"></i>复制
                            </button>
                            <pre><code class="language-python">class HelloAgentsLLM:
    def __init__(self, model: str = None, apiKey: str = None, baseUrl: str = None, timeout: int = None):
        self.model = model or os.getenv("LLM_MODEL_ID")
        apiKey = apiKey or os.getenv("LLM_API_KEY")
        baseUrl = baseUrl or os.getenv("LLM_BASE_URL")
        timeout = timeout or int(os.getenv("LLM_TIMEOUT", 60))

        if not all([self.model, apiKey, baseUrl]):
            raise ValueError("模型ID、API密钥和服务地址必须被提供或在.env文件中定义。")

        self.client = OpenAI(api_key=apiKey, base_url=baseUrl, timeout=timeout)

    def think(self, messages: List[Dict[str, str]], temperature: float = 0) -> str:
        response = self.client.chat.completions.create(
            model=self.model,
            messages=messages,
            temperature=temperature,
            stream=True,
        )
        collected_content = []
        for chunk in response:
            content = chunk.choices[0].delta.content or ""
            print(content, end="", flush=True)
            collected_content.append(content)
        return "".join(collected_content)</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ReAct Section -->
        <section id="react" class="mb-12 fade-in">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                <i class="fas fa-brain mr-3 text-purple-600"></i>
                4.2 ReAct (Reasoning and Acting)
            </h2>

            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg mb-6">
                <p class="text-gray-700 dark:text-gray-300 mb-6">
                    ReAct 由 Shunyu Yao 于2022年提出，其核心思想是模仿人类解决问题的方式，将<strong>推理 (Reasoning)</strong> 与<strong>行动 (Acting)</strong> 显式地结合起来，形成一个"思考-行动-观察"的循环。
                </p>

                <!-- ReAct Workflow Diagram -->
                <div class="mermaid-container mb-6">
                    <div class="text-gray-700 dark:text-gray-300 mb-4">
                        <h3 class="font-semibold mb-3">ReAct 工作流程</h3>
                        <div class="flex items-center justify-center space-x-4">
                            <div class="text-center">
                                <div class="w-20 h-20 bg-purple-600 text-white rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-lightbulb text-2xl"></i>
                                </div>
                                <p class="text-sm font-medium">思考</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400">Thought</p>
                            </div>
                            <i class="fas fa-arrow-right text-gray-400"></i>
                            <div class="text-center">
                                <div class="w-20 h-20 bg-blue-600 text-white rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-cogs text-2xl"></i>
                                </div>
                                <p class="text-sm font-medium">行动</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400">Action</p>
                            </div>
                            <i class="fas fa-arrow-right text-gray-400"></i>
                            <div class="text-center">
                                <div class="w-20 h-20 bg-green-600 text-white rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-eye text-2xl"></i>
                                </div>
                                <p class="text-sm font-medium">观察</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400">Observation</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ReAct Features -->
                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4">
                        <i class="fas fa-eye text-purple-600 dark:text-purple-400 mb-2"></i>
                        <h4 class="font-semibold text-gray-900 dark:text-white mb-1">高可解释性</h4>
                        <p class="text-sm text-gray-700 dark:text-gray-300">
                            通过 Thought 链，可以清晰地看到智能体每一步的"心路历程"
                        </p>
                    </div>
                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                        <i class="fas fa-sync-alt text-blue-600 dark:text-blue-400 mb-2"></i>
                        <h4 class="font-semibold text-gray-900 dark:text-white mb-1">动态规划能力</h4>
                        <p class="text-sm text-gray-700 dark:text-gray-300">
                            根据每一步的 Observation 来动态调整后续的 Thought 和 Action
                        </p>
                    </div>
                    <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4">
                        <i class="fas fa-tools text-green-600 dark:text-green-400 mb-2"></i>
                        <h4 class="font-semibold text-gray-900 dark:text-white mb-1">工具协同能力</h4>
                        <p class="text-sm text-gray-700 dark:text-gray-300">
                            将 LLM 的推理能力与外部工具的执行能力结合
                        </p>
                    </div>
                </div>

                <!-- ReAct Code Example -->
                <div class="border-l-4 border-purple-600 pl-4">
                    <h3 class="font-semibold text-gray-900 dark:text-white mb-3">ReAct 智能体核心实现</h3>
                    <div class="code-block">
                        <button @click="copyToClipboard('class ReActAgent:\n    def __init__(self, llm_client: HelloAgentsLLM, tool_executor: ToolExecutor, max_steps: int = 5):\n        self.llm_client = llm_client\n        self.tool_executor = tool_executor\n        self.max_steps = max_steps\n        self.history = []\n\n    def run(self, question: str):\n        self.history = []\n        current_step = 0\n        \n        while current_step < self.max_steps:\n            current_step += 1\n            # 1. 格式化提示词\n            tools_desc = self.tool_executor.getAvailableTools()\n            history_str = \"\\n\".join(self.history)\n            prompt = REACT_PROMPT_TEMPLATE.format(\n                tools=tools_desc,\n                question=question,\n                history=history_str\n            )\n            \n            # 2. 调用LLM进行思考\n            messages = [{\"role\": \"user\", \"content\": prompt}]\n            response_text = self.llm_client.think(messages=messages)\n            \n            # 3. 解析LLM的输出\n            thought, action = self._parse_output(response_text)\n            \n            # 4. 执行Action\n            if action.startswith(\"Finish\"):\n                final_answer = re.match(r\"Finish\\[(.*)\\]\", action).group(1)\n                return final_answer\n            \n            # 5. 执行工具并记录结果\n            tool_name, tool_input = self._parse_action(action)\n            observation = self.tool_executor.getTool(tool_name)(tool_input)\n            \n            self.history.append(f\"Action: {action}\")\n            self.history.append(f\"Observation: {observation}\")')" class="copy-button px-3 py-1 bg-purple-600 text-white rounded-md text-sm hover:bg-purple-700">
                            <i class="fas fa-copy mr-1"></i>复制
                        </button>
                        <pre><code class="language-python">class ReActAgent:
    def __init__(self, llm_client: HelloAgentsLLM, tool_executor: ToolExecutor, max_steps: int = 5):
        self.llm_client = llm_client
        self.tool_executor = tool_executor
        self.max_steps = max_steps
        self.history = []

    def run(self, question: str):
        self.history = []
        current_step = 0

        while current_step < self.max_steps:
            current_step += 1
            # 1. 格式化提示词
            tools_desc = self.tool_executor.getAvailableTools()
            history_str = "\n".join(self.history)
            prompt = REACT_PROMPT_TEMPLATE.format(
                tools=tools_desc,
                question=question,
                history=history_str
            )

            # 2. 调用LLM进行思考
            messages = [{"role": "user", "content": prompt}]
            response_text = self.llm_client.think(messages=messages)

            # 3. 解析LLM的输出
            thought, action = self._parse_output(response_text)

            # 4. 执行Action
            if action.startswith("Finish"):
                final_answer = re.match(r"Finish\[(.*)\]", action).group(1)
                return final_answer

            # 5. 执行工具并记录结果
            tool_name, tool_input = self._parse_action(action)
            observation = self.tool_executor.getTool(tool_name)(tool_input)

            self.history.append(f"Action: {action}")
            self.history.append(f"Observation: {observation}")</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Plan-and-Solve Section -->
        <section id="plan-solve" class="mb-12 fade-in">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                <i class="fas fa-tasks mr-3 text-purple-600"></i>
                4.3 Plan-and-Solve
            </h2>

            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg mb-6">
                <p class="text-gray-700 dark:text-gray-300 mb-6">
                    Plan-and-Solve 将任务处理明确地分为两个阶段：<strong>先规划 (Plan)，后执行 (Solve)</strong>。这种范式特别适用于结构性强、可以被清晰分解的复杂任务。
                </p>

                <!-- Plan-and-Solve Workflow -->
                <div class="mermaid-container mb-6">
                    <div class="text-gray-700 dark:text-gray-300 mb-4">
                        <h3 class="font-semibold mb-3">Plan-and-Solve 工作流程</h3>
                        <div class="space-y-4">
                            <div class="flex items-center space-x-4">
                                <div class="w-24 h-24 bg-blue-600 text-white rounded-lg flex items-center justify-center">
                                    <div class="text-center">
                                        <i class="fas fa-clipboard-list text-2xl mb-1"></i>
                                        <p class="text-sm font-medium">规划阶段</p>
                                    </div>
                                </div>
                                <div class="flex-1 bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                                    <p class="text-sm text-gray-700 dark:text-gray-300">
                                        将问题分解，制定清晰、分步骤的行动计划
                                    </p>
                                </div>
                            </div>
                            <i class="fas fa-arrow-down text-center text-gray-400"></i>
                            <div class="flex items-center space-x-4">
                                <div class="w-24 h-24 bg-green-600 text-white rounded-lg flex items-center justify-center">
                                    <div class="text-center">
                                        <i class="fas fa-play text-2xl mb-1"></i>
                                        <p class="text-sm font-medium">执行阶段</p>
                                    </div>
                                </div>
                                <div class="flex-1 bg-green-50 dark:bg-green-900/20 rounded-lg p-4">
                                    <p class="text-sm text-gray-700 dark:text-gray-300">
                                        严格按照计划中的步骤，逐一执行
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Plan-and-Solve Components -->
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-900 dark:text-white mb-3">
                            <i class="fas fa-edit mr-2 text-blue-600"></i>
                            规划器 (Planner)
                        </h4>
                        <div class="code-block">
                            <button @click="copyToClipboard('class Planner:\n    def __init__(self, llm_client):\n        self.llm_client = llm_client\n\n    def plan(self, question: str) -> list[str]:\n        prompt = PLANNER_PROMPT_TEMPLATE.format(question=question)\n        messages = [{\"role\": \"user\", \"content\": prompt}]\n        \n        response_text = self.llm_client.think(messages=messages)\n        \n        # 解析LLM输出的列表字符串\n        plan_str = response_text.split(\"```python\")[1].split(\"```\")[0].strip()\n        plan = ast.literal_eval(plan_str)\n        return plan if isinstance(plan, list) else []')" class="copy-button px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700">
                                <i class="fas fa-copy mr-1"></i>复制
                            </button>
                            <pre><code class="language-python">class Planner:
    def __init__(self, llm_client):
        self.llm_client = llm_client

    def plan(self, question: str) -> list[str]:
        prompt = PLANNER_PROMPT_TEMPLATE.format(question=question)
        messages = [{"role": "user", "content": prompt}]

        response_text = self.llm_client.think(messages=messages)

        # 解析LLM输出的列表字符串
        plan_str = response_text.split("```python")[1].split("```")[0].strip()
        plan = ast.literal_eval(plan_str)
        return plan if isinstance(plan, list) else []</code></pre>
                        </div>
                    </div>

                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-900 dark:text-white mb-3">
                            <i class="fas fa-cogs mr-2 text-green-600"></i>
                            执行器 (Executor)
                        </h4>
                        <div class="code-block">
                            <button @click="copyToClipboard('class Executor:\n    def __init__(self, llm_client):\n        self.llm_client = llm_client\n\n    def execute(self, question: str, plan: list[str]) -> str:\n        history = \"\"\n        \n        for i, step in enumerate(plan):\n            prompt = EXECUTOR_PROMPT_TEMPLATE.format(\n                question=question,\n                plan=plan,\n                history=history if history else \"无\",\n                current_step=step\n            )\n            \n            messages = [{\"role\": \"user\", \"content\": prompt}]\n            response_text = self.llm_client.think(messages=messages)\n            \n            # 更新历史记录\n            history += f\"步骤 {i+1}: {step}\\n结果: {response_text}\\n\\n\"\n        \n        return response_text')" class="copy-button px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700">
                                <i class="fas fa-copy mr-1"></i>复制
                            </button>
                            <pre><code class="language-python">class Executor:
    def __init__(self, llm_client):
        self.llm_client = llm_client

    def execute(self, question: str, plan: list[str]) -> str:
        history = ""

        for i, step in enumerate(plan):
            prompt = EXECUTOR_PROMPT_TEMPLATE.format(
                question=question,
                plan=plan,
                history=history if history else "无",
                current_step=step
            )

            messages = [{"role": "user", "content": prompt}]
            response_text = self.llm_client.think(messages=messages)

            # 更新历史记录
            history += f"步骤 {i+1}: {step}\n结果: {response_text}\n\n"

        return response_text</code></pre>
                        </div>
                    </div>
                </div>

                <!-- Example Use Case -->
                <div class="bg-gray-50 dark:bg-gray-700/30 rounded-lg p-4 mb-4">
                    <h4 class="font-semibold text-gray-900 dark:text-white mb-2">应用示例</h4>
                    <p class="text-sm text-gray-700 dark:text-gray-300 mb-2">
                        <strong>问题：</strong>一个水果店周一卖出了15个苹果。周二卖出的苹果数量是周一的两倍。周三卖出的数量比周二少了5个。请问这三天总共卖出了多少个苹果？
                    </p>
                    <div class="bg-white dark:bg-gray-800 rounded p-3">
                        <p class="text-sm font-medium text-gray-900 dark:text-white mb-1">生成的计划：</p>
                        <code class="text-xs text-gray-600 dark:text-gray-400">
                            ["计算周一销量: 15个", "计算周二销量: 15×2=30个", "计算周三销量: 30-5=25个", "计算总销量: 15+30+25=70个"]
                        </code>
                    </div>
                </div>
            </div>
        </section>

        <!-- Reflection Section -->
        <section id="reflection" class="mb-12 fade-in">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                <i class="fas fa-sync-alt mr-3 text-purple-600"></i>
                4.4 Reflection (自我反思)
            </h2>

            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg mb-6">
                <p class="text-gray-700 dark:text-gray-300 mb-6">
                    Reflection 机制的核心思想是为智能体引入一种<strong>事后自我校正循环</strong>，使其能够像人类一样，审视自己的工作，发现不足，并进行迭代优化。
                </p>

                <!-- Reflection Workflow -->
                <div class="mermaid-container mb-6">
                    <div class="text-gray-700 dark:text-gray-300 mb-4">
                        <h3 class="font-semibold mb-3">Reflection 工作流程</h3>
                        <div class="flex items-center justify-center space-x-4 flex-wrap">
                            <div class="text-center">
                                <div class="w-20 h-20 bg-orange-600 text-white rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-play text-2xl"></i>
                                </div>
                                <p class="text-sm font-medium">执行</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400">Execution</p>
                            </div>
                            <i class="fas fa-arrow-right text-gray-400"></i>
                            <div class="text-center">
                                <div class="w-20 h-20 bg-yellow-600 text-white rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-search text-2xl"></i>
                                </div>
                                <p class="text-sm font-medium">反思</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400">Reflection</p>
                            </div>
                            <i class="fas fa-arrow-right text-gray-400"></i>
                            <div class="text-center">
                                <div class="w-20 h-20 bg-green-600 text-white rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-tools text-2xl"></i>
                                </div>
                                <p class="text-sm font-medium">优化</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400">Refinement</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Memory Module -->
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-6">
                    <h4 class="font-semibold text-gray-900 dark:text-white mb-3">
                        <i class="fas fa-memory mr-2 text-purple-600"></i>
                        记忆模块 (Memory)
                    </h4>
                    <div class="code-block">
                        <button @click="copyToClipboard('class Memory:\n    def __init__(self):\n        self.records: List[Dict[str, Any]] = []\n\n    def add_record(self, record_type: str, content: str):\n        record = {\"type\": record_type, \"content\": content}\n        self.records.append(record)\n\n    def get_trajectory(self) -> str:\n        trajectory_parts = []\n        for record in self.records:\n            if record[\'type\'] == \'execution\':\n                trajectory_parts.append(f\"--- 上一轮尝试 ---\\n{record[\'content\']}\")\n            elif record[\'type\'] == \'reflection\':\n                trajectory_parts.append(f\"--- 评审员反馈 ---\\n{record[\'content\']}\")\n        return \"\\n\\n\".join(trajectory_parts)\n\n    def get_last_execution(self) -> Optional[str]:\n        for record in reversed(self.records):\n            if record[\'type\'] == \'execution\':\n                return record[\'content\']\n        return None')" class="copy-button px-3 py-1 bg-purple-600 text-white rounded-md text-sm hover:bg-purple-700">
                            <i class="fas fa-copy mr-1"></i>复制
                        </button>
                        <pre><code class="language-python">class Memory:
    def __init__(self):
        self.records: List[Dict[str, Any]] = []

    def add_record(self, record_type: str, content: str):
        record = {"type": record_type, "content": content}
        self.records.append(record)

    def get_trajectory(self) -> str:
        trajectory_parts = []
        for record in self.records:
            if record['type'] == 'execution':
                trajectory_parts.append(f"--- 上一轮尝试 ---\n{record['content']}")
            elif record['type'] == 'reflection':
                trajectory_parts.append(f"--- 评审员反馈 ---\n{record['content']}")
        return "\n\n".join(trajectory_parts)

    def get_last_execution(self) -> Optional[str]:
        for record in reversed(self.records):
            if record['type'] == 'execution':
                return record['content']
        return None</code></pre>
                    </div>
                </div>

                <!-- Example Use Case -->
                <div class="bg-gray-50 dark:bg-gray-700/30 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-900 dark:text-white mb-2">代码优化示例</h4>
                    <p class="text-sm text-gray-700 dark:text-gray-300 mb-3">
                        <strong>任务：</strong>编写一个Python函数，找出1到n之间所有的素数
                    </p>

                    <!-- Iteration Process -->
                    <div class="space-y-3">
                        <div class="bg-white dark:bg-gray-800 rounded p-3">
                            <p class="text-sm font-medium text-gray-900 dark:text-white mb-1">
                                <i class="fas fa-play-circle text-orange-600 mr-2"></i>
                                初始实现（时间复杂度 O(n√n)）
                            </p>
                            <code class="text-xs text-gray-600 dark:text-gray-400">
                                简单的试除法，效率较低
                            </code>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded p-3">
                            <p class="text-sm font-medium text-gray-900 dark:text-white mb-1">
                                <i class="fas fa-search-circle text-yellow-600 mr-2"></i>
                                反思阶段
                            </p>
                            <code class="text-xs text-gray-600 dark:text-gray-400">
                                发现算法效率问题，建议使用埃拉托斯特尼筛法
                            </code>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded p-3">
                            <p class="text-sm font-medium text-gray-900 dark:text-white mb-1">
                                <i class="fas fa-tools-circle text-green-600 mr-2"></i>
                                优化实现（时间复杂度 O(n log log n)）
                            </p>
                            <code class="text-xs text-gray-600 dark:text-gray-400">
                                使用筛法，显著提升性能
                            </code>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Comparison Section -->
        <section id="comparison" class="mb-12 fade-in">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                <i class="fas fa-balance-scale mr-3 text-purple-600"></i>
                4.5 范式对比分析
            </h2>

            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg overflow-hidden">
                <div class="comparison-table">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                <th class="text-left py-3 px-4 text-gray-900 dark:text-white">范式</th>
                                <th class="text-left py-3 px-4 text-gray-900 dark:text-white">核心特点</th>
                                <th class="text-left py-3 px-4 text-gray-900 dark:text-white">优势</th>
                                <th class="text-left py-3 px-4 text-gray-900 dark:text-white">局限</th>
                                <th class="text-left py-3 px-4 text-gray-900 dark:text-white">适用场景</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                <td class="py-3 px-4">
                                    <span class="font-semibold text-purple-600 dark:text-purple-400">ReAct</span>
                                </td>
                                <td class="py-3 px-4 text-gray-700 dark:text-gray-300">思考-行动-观察循环</td>
                                <td class="py-3 px-4 text-gray-700 dark:text-gray-300">高可解释性、动态纠错</td>
                                <td class="py-3 px-4 text-gray-700 dark:text-gray-300">效率较低、可能陷入循环</td>
                                <td class="py-3 px-4 text-gray-700 dark:text-gray-300">探索性任务、需要外部工具</td>
                            </tr>
                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                <td class="py-3 px-4">
                                    <span class="font-semibold text-blue-600 dark:text-blue-400">Plan-and-Solve</span>
                                </td>
                                <td class="py-3 px-4 text-gray-700 dark:text-gray-300">先规划后执行</td>
                                <td class="py-3 px-4 text-gray-700 dark:text-gray-300">结构性强、稳定性高</td>
                                <td class="py-3 px-4 text-gray-700 dark:text-gray-300">缺乏灵活性、适应性差</td>
                                <td class="py-3 px-4 text-gray-700 dark:text-gray-300">逻辑推理任务、多步计算</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4">
                                    <span class="font-semibold text-green-600 dark:text-green-400">Reflection</span>
                                </td>
                                <td class="py-3 px-4 text-gray-700 dark:text-gray-300">执行-反思-优化迭代</td>
                                <td class="py-3 px-4 text-gray-700 dark:text-gray-300">质量高、自我纠错</td>
                                <td class="py-3 px-4 text-gray-700 dark:text-gray-300">成本高、延迟大</td>
                                <td class="py-3 px-4 text-gray-700 dark:text-gray-300">代码生成、高质量要求</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Summary Section -->
        <section id="summary" class="mb-12 fade-in">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                <i class="fas fa-book-reader mr-3 text-purple-600"></i>
                本章小结
            </h2>

            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                <p class="text-gray-700 dark:text-gray-300 mb-6">
                    在本章中，我们通过"亲手造轮子"的方式，从零开始编码实现了三种业界经典的智能体构建范式：ReAct、Plan-and-Solve 与 Reflection。
                </p>

                <!-- Key Takeaways -->
                <div class="space-y-4 mb-6">
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center text-sm font-bold">1</div>
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-white">ReAct</h4>
                            <p class="text-sm text-gray-700 dark:text-gray-300">
                                构建了能与外部世界交互的智能体，核心优势在于环境适应性和动态纠错能力
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-bold">2</div>
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-white">Plan-and-Solve</h4>
                            <p class="text-sm text-gray-700 dark:text-gray-300">
                                实现了先规划后执行的智能体，核心优势在于结构性和稳定性
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-bold">3</div>
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-white">Reflection</h4>
                            <p class="text-sm text-gray-700 dark:text-gray-300">
                                构建了具备自我优化能力的智能体，核心价值在于显著提升解决方案质量
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Next Steps -->
                <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-900 dark:text-white mb-2">
                        <i class="fas fa-arrow-right mr-2"></i>
                        下一步学习
                    </h4>
                    <p class="text-sm text-gray-700 dark:text-gray-300">
                        下一节我们将会探索不同低代码平台的使用方式以及轻代码构建agent的方案。
                    </p>
                </div>
            </div>
        </section>

        <!-- References Section -->
        <section id="references" class="mb-12 fade-in">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                <i class="fas fa-book mr-3 text-purple-600"></i>
                参考文献
            </h2>

            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                <ol class="space-y-3 list-decimal list-inside text-gray-700 dark:text-gray-300">
                    <li>
                        Yao S, Zhao J, Yu D, et al. React: Synergizing reasoning and acting in language models[C]//International Conference on Learning Representations (ICLR). 2023.
                    </li>
                    <li>
                        Wang L, Xu W, Lan Y, et al. Plan-and-solve prompting: Improving zero-shot chain-of-thought reasoning by large language models[J]. arXiv preprint arXiv:2305.04091, 2023.
                    </li>
                    <li>
                        Shinn N, Cassano F, Gopinath A, et al. Reflexion: Language agents with verbal reinforcement learning[J]. Advances in Neural Information Processing Systems, 2023, 36: 8634-8652.
                    </li>
                </ol>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mt-16">
        <div class="max-w-7xl mx-auto px-6 py-8">
            <div class="flex items-center justify-between">
                <div class="text-gray-600 dark:text-gray-400">
                    <p>© 2025 Hello Agents - Datawhale 智能体教程</p>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="../index.html" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white">
                        <i class="fas fa-home mr-2"></i>
                        返回首页
                    </a>
                    <button @click="scrollToTop()" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white">
                        <i class="fas fa-arrow-up mr-2"></i>
                        回到顶部
                    </button>
                </div>
            </div>
        </div>
    </footer>

    <!-- Toast Notification -->
    <div x-show="showToast" x-transition class="fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50">
        <div class="flex items-center">
            <i class="fas fa-check-circle mr-2"></i>
            <span x-text="toastMessage"></span>
        </div>
    </div>

    <script>
        // Alpine.js application data
        function chapterApp() {
            return {
                darkMode: false,
                showTOC: false,
                activeSection: '',
                showToast: false,
                toastMessage: '',
                tocItems: [
                    { id: 'overview', title: '章节概览' },
                    { id: 'environment', title: '4.1 环境准备与基础工具定义' },
                    { id: 'react', title: '4.2 ReAct (Reasoning and Acting)' },
                    { id: 'plan-solve', title: '4.3 Plan-and-Solve' },
                    { id: 'reflection', title: '4.4 Reflection (自我反思)' },
                    { id: 'comparison', title: '4.5 范式对比分析' },
                    { id: 'summary', title: '本章小结' },
                    { id: 'references', title: '参考文献' }
                ],

                init() {
                    this.initDarkMode();
                    this.initScrollObserver();
                    this.initLazyLoading();
                    this.initSmoothScroll();
                },

                initDarkMode() {
                    // Check for saved preference or default to system preference
                    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                        this.darkMode = true;
                        document.documentElement.classList.add('dark');
                    } else {
                        this.darkMode = false;
                        document.documentElement.classList.remove('dark');
                    }
                },

                toggleDarkMode() {
                    this.darkMode = !this.darkMode;
                    if (this.darkMode) {
                        document.documentElement.classList.add('dark');
                        localStorage.theme = 'dark';
                    } else {
                        document.documentElement.classList.remove('dark');
                        localStorage.theme = 'light';
                    }
                },

                toggleTOC() {
                    this.showTOC = !this.showTOC;
                },

                scrollToSection(sectionId) {
                    this.showTOC = false;
                    const element = document.getElementById(sectionId);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        this.activeSection = sectionId;
                    }
                },

                initScrollObserver() {
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                this.activeSection = entry.target.id;
                                entry.target.classList.add('loaded');
                            }
                        });
                    }, { threshold: 0.1 });

                    // Observe all sections
                    this.tocItems.forEach(item => {
                        const element = document.getElementById(item.id);
                        if (element) {
                            observer.observe(element);
                        }
                    });
                },

                initLazyLoading() {
                    const lazyElements = document.querySelectorAll('.lazy-load');
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.classList.add('loaded');
                            }
                        });
                    });

                    lazyElements.forEach(element => {
                        observer.observe(element);
                    });
                },

                initSmoothScroll() {
                    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                        anchor.addEventListener('click', function (e) {
                            e.preventDefault();
                            const targetId = this.getAttribute('href').substring(1);
                            const targetElement = document.getElementById(targetId);
                            if (targetElement) {
                                targetElement.scrollIntoView({ behavior: 'smooth' });
                            }
                        });
                    });
                },

                copyToClipboard(text) {
                    navigator.clipboard.writeText(text).then(() => {
                        this.showNotification('已复制到剪贴板');
                    }).catch(() => {
                        // Fallback for older browsers
                        const textArea = document.createElement('textarea');
                        textArea.value = text;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        this.showNotification('已复制到剪贴板');
                    });
                },

                showNotification(message) {
                    this.toastMessage = message;
                    this.showToast = true;
                    setTimeout(() => {
                        this.showToast = false;
                    }, 3000);
                },

                scrollToTop() {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }
        }

        // Initialize Prism.js after page load
        document.addEventListener('DOMContentLoaded', function() {
            Prism.highlightAll();

            // Re-highlight code blocks when dark mode changes
            const observer = new MutationObserver(() => {
                Prism.highlightAll();
            });

            observer.observe(document.documentElement, {
                attributes: true,
                attributeFilter: ['class']
            });
        });
    </script>
</body>
</html>